<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Retailer Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', sans-serif
    }

    body {
      background: #f7fbfa
    }

    .layout {
      display: flex;
      min-height: 100vh
    }

    /* SIDEBAR */
    .sidebar {
      width: 240px;
      background: #ffffff;
      border-right: 1px solid #e5e7eb;
      padding: 20px;
      position: relative
    }

    .logo {
      font-size: 22px;
      font-weight: 600;
      color: #10b981;
      margin-bottom: 30px
    }

    .menu a {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 14px;
      color: #555;
      text-decoration: none;
      border-radius: 8px;
      margin-bottom: 6px
    }

    .menu a.active,
    .menu a:hover {
      background: #e7f8f2;
      color: #10b981
    }

    .menu i {
      width: 20px
    }

    .logout {
      position: absolute;
      bottom: 20px;
      width: calc(100% - 40px)
    }

    /* MAIN */
    .main {
      flex: 1;
      padding: 28px
    }

    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px
    }

    .topbar .right {
      display: flex;
      gap: 20px;
      align-items: center;
      color: #555
    }

    h1 {
      font-size: 28px;
      margin-bottom: 6px
    }

    .subtitle {
      color: #6b7280;
      margin-bottom: 24px
    }

    /* STATS */
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin-bottom: 30px
    }

    .stat {
      background: #fff;
      border-radius: 14px;
      padding: 20px;
      display: flex;
      gap: 14px;
      align-items: center;
      box-shadow: 0 6px 18px rgba(0, 0, 0, 0.05)
    }

    .icon {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #10b981;
      background: #e7f8f2
    }

    .stat h2 {
      font-size: 24px
    }

    .stat p {
      font-size: 13px;
      color: #6b7280
    }

    /* QUICK CARDS */
    .quick {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 24px
    }

    .quick-card {
      background: #fff;
      border-radius: 16px;
      padding: 22px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 8px 22px rgba(0, 0, 0, 0.06)
    }

    .quick-left {
      display: flex;
      gap: 14px;
      align-items: center
    }

    .quick-icon {
      width: 48px;
      height: 48px;
      border-radius: 14px;
      background: #10b981;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center
    }

    .quick-card h3 {
      font-size: 18px
    }

    .quick-card p {
      font-size: 14px;
      color: #6b7280
    }

    @media(max-width:768px) {
      .sidebar {
        display: none
      }
    }
  </style>
</head>

<body>

  <div class="layout">

    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="logo">ðŸŒ± ROOTS</div>
      <div class="menu">
        <a class="active"><i class="fa fa-chart-pie"></i>Dashboard</a>
        <a href="products.html"><i class="fa fa-store"></i>Browse Products</a>
        <a href="./myorder.html"><i class="fa fa-box"></i>My Orders</a>
        <a href="place-order.html"><i class="fa fa-box"></i>My Cart</a>
        <a><i class="fa fa-truck"></i>Order Tracking</a>
        <a><i class="fa fa-credit-card"></i>Payments</a>
        <a><i class="fa fa-message"></i>Messages</a>
        <a href="./profile.html"><i class="fa fa-user"></i>Profile</a>
        <a><i class="fa fa-gear"></i>Settings</a>
      </div>
      <div class="logout">
        <a class="menu" onclick="logout()"><i class="fa fa-sign-out"></i>Logout</a>
      </div>
    </aside>

    <!-- MAIN -->
    <main class="main">

      <div class="topbar">
        <div></div>
        <div class="right">Welcome, <b>Retailer</b> | <i class="fa fa-cart-shopping"></i> Cart | <i
            class="fa fa-bell"></i></div>
      </div>

      <h1>Retailer Dashboard</h1>
      <p class="subtitle">Browse products, place orders, and track your purchases</p>

      <!-- STATS -->
      <div class="stats">
        <div class="stat">
          <div class="icon"><i class="fa fa-box"></i></div>
          <div>
            <h2 id="total">6</h2>
            <p>Total Orders</p>
          </div>
        </div>
        <div class="stat">
          <div class="icon"><i class="fa fa-clock"></i></div>
          <div>
            <h2 id="pending">6</h2>
            <p>Pending Orders</p>
          </div>
        </div>
        <div class="stat">
          <div class="icon"><i class="fa fa-check"></i></div>
          <div>
            <h2 id="completed">0</h2>
            <p>Completed Orders</p>
          </div>
        </div>
      </div>

      <!-- QUICK ACTIONS -->
      <div class="quick">
        <div class="quick-card">
          <div class="quick-left">
            <div class="quick-icon"><i class="fa fa-search"></i></div>
            <div>
              <h3>Browse Products</h3>
              <p>View all available products from farmers</p>
            </div>
          </div>
          <i class="fa fa-arrow-right"></i>
        </div>

        <div class="quick-card">
          <div class="quick-left">
            <div class="quick-icon"><i class="fa fa-receipt"></i></div>
            <div>
              <h3>My Orders</h3>
              <p>Track all your placed orders</p>
            </div>
          </div>
          <i class="fa fa-arrow-right"></i>
        </div>
      </div>

    </main>
  </div>
  <script>
    /* ================= AUTH ================= */
    const userStr = localStorage.getItem("user");

    if (!userStr) {
      alert("Please login");
      window.location.href = "login.html";
    }

    const user = JSON.parse(userStr);

    // Role check
    if (!String(user.role || "").toUpperCase().includes("RETAILER")) {
      alert("Retailer access only");
      window.location.href = "login.html";
    }

    /* ================= LOAD DASHBOARD STATS ================= */
    fetch(`http://localhost:8080/api/orders/retailer/${user.id}`)
      .then(res => res.json())
      .then(orders => {

        const totalOrders = orders.length;

        // Pending orders
        const pendingStatuses = ["PLACED", "YET TO PROCESS", "PROCESSING", "SHIPPED"];
        const pendingOrders = orders.filter(o => pendingStatuses.includes(o.status.toUpperCase())).length;

        // Completed orders
        const completedStatuses = ["DELIVERED", "COMPLETED"];
        const completedOrders = orders.filter(o => completedStatuses.includes(o.status.toUpperCase())).length;

        // Cancelled orders
        const cancelledOrders = orders.filter(o => o.status?.toUpperCase() === "CANCELLED").length;

        document.getElementById("total").innerText = totalOrders;
        document.getElementById("pending").innerText = pendingOrders;
        document.getElementById("completed").innerText = completedOrders;

        console.log({ totalOrders, pendingOrders, completedOrders, cancelledOrders });
      })
      .catch(err => {
        console.error(err);
        document.getElementById("total").innerText = 0;
        document.getElementById("pending").innerText = 0;
        document.getElementById("completed").innerText = 0;
      });


    /* ================= QUICK CARD NAVIGATION ================= */
    const quickCards = document.querySelectorAll(".quick-card");

    quickCards[0].addEventListener("click", () => {
      window.location.href = "products.html";
    });

    quickCards[1].addEventListener("click", () => {
      window.location.href = "myorder.html";
    });

    /* ================= LOGOUT ================= */
    function logout() {
      localStorage.removeItem("user");
      window.location.href = "login.html";
    }
  </script>
  <script src="notifications.js"></script>
</body>

</html>